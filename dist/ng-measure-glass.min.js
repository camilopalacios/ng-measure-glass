"use strict";!function(){var t={},i=function(t,i,s,e,a){this.element=t,this.values=[];for(var h in i)this.values.push(parseInt(i[h],10));this.min=s,this.max=e,this.colors=a,this.svg,this.svgGroup,this.width,this.height,this.glass,this.liquids,this.liquidsText};i.prototype.valueToHeight=function(t,i){return this.height*(t/i)},i.prototype.calculateLiquidsData=function(){var t=[],i=this.height;for(var s in this.values)i-=this.valueToHeight(this.values[s],this.max),t.push({x:0,y:i,width:.7*this.width,height:this.valueToHeight(this.values[s],this.max),rx:.02*this.width,value:this.values[s]});return t},i.prototype.makeValid=function(t,i,s){var e=0;for(var a in t)e+=t[a];if(e>s)for(var a in t)t[a]=Math.floor(t[a]*s/e);return t},i.prototype.createMainComponents=function(){this.svg=d3.select(this.element).append("svg").attr({width:"100%",height:"100%"}),this.width=parseInt(this.svg.style("width"),10),this.height=parseInt(this.svg.style("height"),10),this.svgGroup=this.svg.append("g")},i.prototype.drawLiquid=function(t,i,s,e){var a=t.append("rect").attr("id",i).attr(s).attr("transform","translate("+.15*this.width+", 0)").style(e);return a},i.prototype.drawLiquidText=function(t,i,s){var e=.1*this.width+"px",a="";s.value>.075*this.max&&(a=s.value);var h=t.append("text").attr("id",i).attr("x",this.width/2).attr("y",s.y+s.height/2).attr("text-anchor","middle").attr("font-size",e).style("fill","#1A1A1A").text(a);return h},i.prototype.drawLiquids=function(t,i,s){var e=[],a="liquid"+h;for(var h in i)e.push(this.drawLiquid(t,a,i[h],{fill:s[h]}));return e},i.prototype.drawLiquidsText=function(t,i){var s=[],e="liquidText"+a;for(var a in i)s.push(this.drawLiquidText(t,e,i[a]));return s},i.prototype.drawGlassContainer=function(t,i){var s=["M "+.1*this.width+","+.14*-this.height+"Q "+.15*this.width+","+.1*-this.height+" "+.15*this.width+","+.05*-this.height+"L "+.15*this.width+","+.9*this.height+"Q "+.15*this.width+","+this.height+" "+.2*this.width+","+this.height+"L "+.8*this.width+","+this.height+"Q "+.85*this.width+","+this.height+" "+.85*this.width+","+.9*this.height+"L "+.85*this.width+","+.05*-this.height+"Q "+.85*this.width+","+.1*-this.height+" "+.9*this.width+","+.14*-this.height],e=t.append("path").attr("id",i).attr("d",s).style("stroke-width",.03*this.width).style("stroke","#16a085").style("fill","none").style("stroke-linecap","round");return e},i.prototype.drawMarkers=function(t,i){var s=.1*this.width+"px";t.append("text").attr("id",i).attr("text-anchor","end").attr("font-size",s).attr("transform","translate("+this.width/8+","+.03*this.height+")").text(this.max+"-"),t.append("text").attr("id",i).attr("text-anchor","end").attr("font-size",s).attr("transform","translate("+this.width/8+","+this.height/1.9+")").text(this.max/2+"-"),t.append("text").attr("id",i).attr("text-anchor","end").attr("font-size",s).attr("transform","translate("+this.width/8+","+this.height+")").text(this.min+"-")},i.prototype.drawComponents=function(){var t=this.calculateLiquidsData();this.liquids=this.drawLiquids(this.svgGroup,t,this.colors),this.liquidsText=this.drawLiquidsText(this.svgGroup,t),this.glassContainer=this.drawGlassContainer(this.svgGroup,"glassContainer"),this.glassMarkers=this.drawMarkers(this.svgGroup,"glassMarkers"),this.animate(this.min),this.svgGroup.attr("transform","scale(0.75) translate("+.2*this.width+","+.25*this.height+")")},i.prototype.draw=function(t){d3.select(this.element).select("svg").remove();var i=this;i.values=i.makeValid(i.values,i.min,i.max),i.createMainComponents(),i.drawComponents()},i.prototype.setValues=function(t){this.values=[];for(var i in t)this.values.push(parseInt(t[i],10));this.values=this.makeValid(this.values,this.min,this.max),this.animate(.95*this.max)},i.prototype.setColors=function(t){this.colors=t;for(var i in this.liquids)this.liquids[i].style("fill",this.colors[i])},i.prototype.animate=function(t){var i=this;i.svgGroup.transition().ease("elastic").duration(3e3).tween("",function(){var s=d3.interpolate(t,i.max);return function(t){var e=s(t),a=i.height;for(var h in i.liquids){a-=i.valueToHeight(i.values[h]*(e/i.max),i.max);var r={x:0,y:a,width:.7*i.width,height:i.valueToHeight(i.values[h]*(e/i.max),i.max),rx:.02*i.width,value:i.values[h]};i.liquids[h].attr(r),Math.floor(r.value)>.075*i.max?i.liquidsText[h].text(Math.floor(r.value)):i.liquidsText[h].text(""),i.liquidsText[h].attr("y",r.y+r.height/2)}}})},t.Glass=i,t.MeasureGlassDirective=function(){return{restrict:"E",scope:{values:"=",colors:"=",min:"=",max:"="},link:function(i,s){i.values=i.values||[],i.min=i.min||0,i.max=i.max||100,i.colors=i.colors||[];var e=new t.Glass(s[0],i.values,i.min,i.max,i.colors);i.$watchCollection("values",function(t,i){null===t&&"undefined"==typeof t||"undefined"==typeof i||t==i||e.setValues(t)}),i.$watchCollection("colors",function(t,i){null===t&&"undefined"==typeof t||"undefined"==typeof i||t==i||e.setColors(t)});var a=function(){e.draw(function(t,s){i.$apply(function(){i.values=t,i.colors=s})})};a()}}},angular.module("ui.measureGlass",[]).directive("uiMeasureGlass",t.MeasureGlassDirective)}();